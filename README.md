# git-issue

A small set of Git scripts that manage issues directly in Git’s object store, modeling each issue as a ref (`refs/issues/*`) with trees/commits — no external server required. It also includes a static HTML generator (`git-issue-generate-page`) that renders an index and one page per issue directly from `refs/issues/*`, with timestamps, authors, and permalinks — no JavaScript or API required.

## Concept

- Each issue is a ref: `refs/issues/<ISSUE_ID>` (where `<ISSUE_ID>` is a Git commit hash) pointing to a commit whose tree contains:
  - `title`: blob with the issue title
  - `status`: blob with the issue state (e.g., `open`)
  - `msgs/`: directory with blobs, each representing a message/reply.
  - First message (created with `new`) is named with a generated short id (e.g., `<gen_id>`).
  - Subsequent messages (via `reply`) are named `<ISSUE_ID>-<gen_id>`.
- Operations (`new`/`reply`/`edit`) assemble trees with `git mktree` and create commits with `git commit-tree`, then update the ref via `git update-ref`.

## Requirements

- Git installed and configured (`user.name` and `user.email`).
- `$EDITOR` (or `$VISUAL`) set; if not, scripts fall back to `vi`.

## Installation

Ensure the git-issue scripts are available on your `PATH` so Git can discover the `git issue` subcommand:

- Add this repository (or the folder containing `git-issue*` files) to your `PATH`.
- Git will automatically run `git-issue` when you type `git issue ...` if an executable named `git-issue` is on `PATH`.
- Example (bash/zsh):
  - `export PATH="$PATH:/path/to/git-issue-repo"`
  - Or symlink: `ln -s /path/to/git-issue-repo/git-issue /usr/local/bin/git-issue`

## Available scripts

- `git issue new "Issue title"`
  - Creates a new issue. Opens the editor for the first message.
  - Updates `refs/issues/<ISSUE_ID>` with a root commit (no parent) containing `title`, `status`, and `msgs/<msg_id>`.
- `git issue show [<ISSUE_ID>]`
  - If omitted, lists issues and prompts for an id.
  - Shows the title and lists all messages (`msgs/*`), indicating the author of the commit that includes each message.
- `git issue reply [<ISSUE_ID>]`
  - If omitted, lists issues and prompts for an id.
  - Adds a message to the issue. Opens the editor for the content.
  - Creates a commit with a parent pointing to the current tip of `refs/issues/<ISSUE_ID>` and updates the ref.
- `git issue edit-title [<ISSUE_ID>]`
  - If omitted, lists issues and prompts for an id.
  - Edits the issue title, creating a new commit (with parent) and updating the ref.
- `git issue edit-msg [<ISSUE_ID>] [<MSG_NUMBER>]`
  - Edits a specific message by its numeric position shown in `git issue show` (1-based). Preserves the message id and creates a new commit.
  - If `<ISSUE_ID>` is omitted, lists and prompts for an id; if `<MSG_NUMBER>` is omitted, shows messages and prompts for a number.
  - Message files live under `msgs/` and are named using the issue id plus a short generated suffix (e.g., `<ISSUE_ID>-<gen_id>`).
- `git issue ls`
  - Lists all issues (`refs/issues/*`) with their titles. Issue IDs are Git hashes (shortened for display).
- `git issue pull` / `git issue push` / `git issue sync`
  - Synchronize issue refs with the remote: fetch/push `refs/issues/*`.

## Recommended workflow

1. Before replying/editing in a fresh clone, fetch issue refs:
   - `git fetch origin 'refs/issues/*:refs/issues/*'` or `./git-issue pull`
2. Create replies/edits (`reply`, `edit-*`).
3. Push:
   - `git push origin 'refs/issues/*:refs/issues/*'` or `./git-issue push`

If push is rejected (non-fast-forward), fetch updates (`pull`) and re-apply your change on the current tip (scripts already use the local tip as parent). Avoid creating replies when the ref doesn’t exist locally, as that produces root commits.

## Web (GitHub Pages)

Static site is generated by `./git-issue-generate-page` into `docs/`:
- Index lists issues from `refs/issues/*` sorted by earliest message timestamp.
- Each issue page shows title, status, opener, timestamps, and all messages with authors.
- Permalinks to each message via anchors.

Link (GitHub Pages):
- https://fco.github.io/git-issue/

### Generate locally

- `./git-issue pull` (or `git fetch origin 'refs/issues/*:refs/issues/*'`)
- `./git-issue-generate-page`
- Open `docs/index.html`

### Publish to GitHub Pages (CI)

This repository includes `.github/workflows/gh-pages.yml` which:
- Checks out with full history (`fetch-depth: 0`).
- Fetches `refs/issues/*`.
- Runs the generator and uploads `docs/` as the Pages artifact.
- Deploys to GitHub Pages.

No React/Vite is required for the static site.

## Tips and troubleshooting

- “Failed to fetch” / rate limit: authenticate and/or wait for `X-RateLimit-Reset`; check headers: `X-RateLimit-*`.
- “non-fast-forward” on push: run `./git-issue pull` and re-apply your reply/edit; verify commit parent:
  - `git log --pretty='%H %P' -n 1 $(git rev-parse refs/issues/<ISSUE_ID>)`
- Empty editor: set `$EDITOR` or `$VISUAL`; default is `vi`.

## License

This project is experimental and uses Git as the backend for issues. Use with care and back up your refs/objects as needed.
